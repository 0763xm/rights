@model Langben.DAL.SysMenu
@{
    Layout = "~/Views/Shared/Edit.cshtml";
}
@using Common
@using Models
@section CurentPlace {
    修改
}
<fieldset>
    <legend>
        <input class="a2 f2" type="submit" value="修改" />
        <input class="a2 f2" type="button" onclick="BackList('SysMenu')" value="返回列表" />
    </legend>
    <div class="bigdiv">
        @Html.HiddenFor(model => model.Id)
        <div class="editor-label">
            @Html.LabelFor(model => model.Name)：
        </div>
        <div class="editor-field">
            @Html.EditorFor(model => model.Name)
            @Html.ValidationMessageFor(model => model.Name)
        </div>
        <div class="editor-label">
            <a class="anUnderLine" onclick="showModalOnly('ParentId','../../SysMenu');">
                @Html.LabelFor(model => model.ParentId)
            </a>：
        </div>
        <div class="editor-field">
            <div id="checkParentId">
                @if (Model != null)
                {
                    if (!string.IsNullOrWhiteSpace(Model.ParentId))
                    {
                        <table id="@Model.ParentId"
                               class="deleteStyle">
                            <tr>
                                <td>
                                    <img alt="删除" title="点击删除" src="../../../Images/deleteimge.png" onclick="deleteTable('@Model.ParentId ','ParentId');" />
                                </td>
                                <td>
                                    @Model.SysMenu2.Name
                                </td>
                            </tr>
                        </table>
                    }
                }
            </div>
            @Html.HiddenFor(model => model.ParentId)
        </div>
        <div class="editor-label">
            @Html.LabelFor(model => model.Url)：
        </div>
        <div class="editor-field">
            @Html.EditorFor(model => model.Url)
            @Html.ValidationMessageFor(model => model.Url)
        </div>
        <div class="editor-label">
            @Html.LabelFor(model => model.Iconic)：
        </div>
        <div class="editor-field">
            @Html.EditorFor(model => model.Iconic)
            @Html.ValidationMessageFor(model => model.Iconic)
        </div>
        <div class="editor-label">
            @Html.LabelFor(model => model.Sort) ：
        </div>
        <div class="editor-field">
            @Html.TextBoxFor(model => model.Sort, new { onkeyup = "isInt(this)", @class = "text-box single-line" })
            @Html.ValidationMessageFor(model => model.Sort)
        </div>
        <br style="clear: both;" />
        <div class="editor-label">
            @Html.LabelFor(model => model.Remark)：
        </div>
        <div class="textarea-box">
            @Html.TextAreaFor(model => model.Remark)
            @Html.ValidationMessageFor(model => model.Remark)
        </div>
        <div class="editor-label">
            @Html.LabelFor(model => model.State)：
        </div>
        <div class="editor-field">
            @Html.RadioButtonListFor(model => model.State, Models.SysFieldModels.GetSysField("SysMenu", "State"), false)
        </div>@Html.HiddenFor(model => model.CreatePerson) @Html.HiddenFor(model => model.CreateTime)
        <div class="editor-label">
            @Html.LabelFor(model => model.IsLeaf)：
        </div>
        <div class="editor-field">
            @Html.EditorFor(model => model.IsLeaf)
            @Html.ValidationMessageFor(model => model.IsLeaf)
        </div>
        <div class="editor-label">
            @Html.LabelFor(model => model.SysOperationId)
        </div>
        <div class="editor-field">
            <div id="checkSysOperationId">
                @{string ids14 = string.Empty, ids15 = string.Empty;
                if (Model != null)
                {
                    foreach (var item14 in Model.SysOperation)
                    {
                        string item141 = string.Empty;
                        item141 += item14.Id + "&" + item14.Name;
                        ids15 += item14.Id + "^";
                        if (ids14.Length > 0)
                        {
                            ids14 += "^" + item141;
                        }
                        else
                        {
                            ids14 += item141;
                        }

                    }
                }
                ids15 = ids15.Length>0 ? ids15.Remove(ids15.Length - 1):"";
                }
                <input type="hidden" value="@ids15" name="SysOperationIds" id="SysOperationIds" />
                <input type="hidden" value="@ids14" name="SysOperationIdOld" id="SysOperationIdOld" />
                <input type="hidden" value="@ids14" name="SysOperationId" id="SysOperationId" />
                <input id="selOperation" class="easyui-combobox" name="language" data-options="multiple:true, multiline:true, method:'post',valueField:'Id',textField:'Name', panelHeight:'auto'  ">
            </div>
        </div>
    </div>
</fieldset>
<script type="text/javascript">
    $(function () {
        $('#selOperation').combobox({
            url: '/SysOperation/GetAllData',
            formatter: function (row) {
                return '<span class="l-btn-left l-btn-icon-left"><span class="l-btn-text">' + row.Name + '</span><span class="l-btn-icon ' + row.Iconic + '">&nbsp;</span></span>';
            },
            onLoadSuccess: function () {
                var selOperList = $("#SysOperationIds").val().split("^");
                $('#selOperation').combobox('setValues', selOperList);
            },
            onSelect: function (row) {
                //var val = $(this).combobox('getValues');
                var newSysOperationId = $("#SysOperationId").val();
                $("#SysOperationId").val(newSysOperationId + (newSysOperationId.length > 0 ? "^" : "") + row.Id + "&" + row.Name);
            },
            onUnselect: function (row) {
                //var val = $(this).combobox('getValues');
                var newSysOperationId = $("#SysOperationId").val();
                var delVal = row.Id + "&" + row.Name;
                if (newSysOperationId.indexOf("^" + delVal) >= 0)
                    newSysOperationId = newSysOperationId.replace("^" + delVal, "");
                else if (newSysOperationId.indexOf(delVal + "^") >= 0)
                    newSysOperationId = newSysOperationId.replace(delVal + "^", "");
                else
                    newSysOperationId = newSysOperationId.replace(delVal, "");
                $("#SysOperationId").val(newSysOperationId);
            }
        });
    });


</script>
